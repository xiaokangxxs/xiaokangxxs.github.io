{"title":"HDFS-JavaAPI","slug":"HDFS-JavaAPI","date":"2021-04-28T12:08:53.842Z","updated":"2021-12-05T23:24:54.985Z","comments":true,"path":"api/articles/HDFS-JavaAPI.json","realPath":null,"excerpt":"大数据存储HDFS-JavaAPI基操","covers":["https://raw.githubusercontent.com/xiaokangxxs/notebook/master/docs/BigData/Hadoop/hadoop_home.png","https://raw.githubusercontent.com/xiaokangxxs/notebook/master/docs/BigData/Hadoop/hadoopenv.png"],"cover":"http://file.xiaokang.cool/colorful/colorful-13.jpg","content":"<h2 id=\"一、前置准备\"><a href=\"#一、前置准备\" class=\"headerlink\" title=\"一、前置准备\"></a>一、前置准备</h2><h3 id=\"1-Windows下配置开发环境\"><a href=\"#1-Windows下配置开发环境\" class=\"headerlink\" title=\"1. Windows下配置开发环境\"></a>1. Windows下配置开发环境</h3><div align=\"center\"> <img width=\"600px\" src=\"https://raw.githubusercontent.com/xiaokangxxs/notebook/master/docs/BigData/Hadoop/hadoop_home.png\"/> </div>\n<div align=\"center\"> <img width=\"600px\" src=\"https://raw.githubusercontent.com/xiaokangxxs/notebook/master/docs/BigData/Hadoop/hadoopenv.png\"/> </div>\n### 2. 基于IDEA创建 maven jar工程\n\n<p>想要使用 HDFS API，需要导入依赖<code>hadoop-common</code>、<code>hadoop-client</code>、 <code>hadoop-hdfs</code>、<code>hadoop-client</code></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class=\"hljs-tag\">         <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"hljs-tag\">         <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">modelVersion</span>&gt;</span>4.0.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">modelVersion</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>cool.xiaokang<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hdfs-java-api<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">properties</span>&gt;</span><br>        <span class=\"hljs-comment\">&lt;!-- jdk版本 --&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">jdk.version</span>&gt;</span>8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">jdk.version</span>&gt;</span><br>        <span class=\"hljs-comment\">&lt;!-- 设置字符编码 --&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project.build.sourceEncoding</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project.reporting.outputEncoding</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">hadoop.version</span>&gt;</span>2.7.7<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">hadoop.version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">properties</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencies</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>log4j-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.11.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-client<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-hdfs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>junit<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>junit<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.12<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>test<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencies</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">build</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugins</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.8.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span><br>                    <span class=\"hljs-comment\">&lt;!-- 设置编译字符编码 --&gt;</span><br>                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">encoding</span>&gt;</span>UTF-8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">encoding</span>&gt;</span><br>                    <span class=\"hljs-comment\">&lt;!-- 设置编译jdk版本 --&gt;</span><br>                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">source</span>&gt;</span>$&#123;jdk.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">source</span>&gt;</span><br>                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">target</span>&gt;</span>$&#123;jdk.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">target</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugins</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">build</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p><strong>log4j.properties</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs properties\"><span class=\"hljs-meta\">log4j.rootLogger</span>=<span class=\"hljs-string\">INFO,console,file</span><br><span class=\"hljs-comment\">#配置输出到控制台</span><br><span class=\"hljs-meta\">log4j.appender.console</span>=<span class=\"hljs-string\">org.apache.log4j.ConsoleAppender</span><br><span class=\"hljs-meta\">log4j.appender.console.layout</span>=<span class=\"hljs-string\">org.apache.log4j.PatternLayout</span><br><span class=\"hljs-meta\">log4j.appender.console.Encoding</span>=<span class=\"hljs-string\">UTF-8</span><br><span class=\"hljs-meta\">log4j.appender.console.layout.ConversionPattern</span>=<span class=\"hljs-string\">%d&#123;yyyy-MM-dd HH\\:mm\\:ss&#125; -%-4r [%t] %-5p  %x - %m%n</span><br><span class=\"hljs-comment\">#配置输入日志到日志文件</span><br><span class=\"hljs-meta\">log4j.appender.file</span>=<span class=\"hljs-string\">org.apache.log4j.FileAppender</span><br><span class=\"hljs-meta\">log4j.appender.file.File</span>=<span class=\"hljs-string\">target/mylog.log</span><br><span class=\"hljs-meta\">log4j.appender.file.layout</span>=<span class=\"hljs-string\">org.apache.log4j.PatternLayout</span><br><span class=\"hljs-meta\">log4j.appender.file.layout.ConversionPattern</span>=<span class=\"hljs-string\">%d %p [%c] - %m%n</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"二、API的使用\"><a href=\"#二、API的使用\" class=\"headerlink\" title=\"二、API的使用\"></a>二、API的使用</h2><h3 id=\"2-1-FileSystem\"><a href=\"#2-1-FileSystem\" class=\"headerlink\" title=\"2.1 FileSystem\"></a>2.1 FileSystem</h3><p>FileSystem 是所有 HDFS 操作的主入口。由于之后的每个小功能的测试都需要用到它，这里使用写了一个工具类HDFSUtils</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> cool.xiaokang.utils;<br><br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.conf.Configuration;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.fs.FileSystem;<br><br><span class=\"hljs-keyword\">import</span> java.io.IOException;<br><span class=\"hljs-keyword\">import</span> java.net.URI;<br><br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * HDFS工具类</span><br><span class=\"hljs-comment\"> *</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> xiaokang</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HDFSUtils</span> </span>&#123;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String HDFS_PATH = <span class=\"hljs-string\">&quot;hdfs://192.168.239.161:9000&quot;</span>;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String HDFS_USER = <span class=\"hljs-string\">&quot;xiaokang&quot;</span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 获取FileSystem对象</span><br><span class=\"hljs-comment\">     *</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span></span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> FileSystem <span class=\"hljs-title\">getFileSystem</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Configuration conf = <span class=\"hljs-keyword\">new</span> Configuration();<br>            <span class=\"hljs-comment\">//conf.set(&quot;dfs.replication&quot;, &quot;3&quot;);</span><br>       \t\t<span class=\"hljs-comment\">//conf.addResource(&quot;hdfs-site.xml&quot;);</span><br>            FileSystem fileSystem = FileSystem.get(<span class=\"hljs-keyword\">new</span> URI(HDFS_PATH), conf, HDFS_USER);<br>            <span class=\"hljs-keyword\">return</span> fileSystem;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (Exception e) &#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！！---&quot;</span> + e.getMessage());<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br>    &#125;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 关闭FileSystem对象</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> fileSystem</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">closeFileSystem</span><span class=\"hljs-params\">(FileSystem fileSystem)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (fileSystem != <span class=\"hljs-keyword\">null</span>) &#123;<br>            <span class=\"hljs-keyword\">try</span> &#123;<br>                fileSystem.close();<br>            &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-实现-ls列表查看\"><a href=\"#2-2-实现-ls列表查看\" class=\"headerlink\" title=\"2.2 实现-ls列表查看\"></a>2.2 实现<code>-ls</code>列表查看</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//HDFS Shell操作：hdfs dfs -ls /input</span><br><span class=\"hljs-comment\">//查看指定目录下所有文件的信息</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testFileStatus</span><span class=\"hljs-params\">(String path)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            FileStatus[] fileStatuses = fs.listStatus(<span class=\"hljs-keyword\">new</span> Path(path));<br>            <span class=\"hljs-keyword\">for</span>(FileStatus file:fileStatuses)&#123;<br>                <span class=\"hljs-comment\">//fileStatus的toString方法被重写过，直接打印可以看到所有信息</span><br>                <span class=\"hljs-comment\">//System.out.println(file.toString());</span><br>                <span class=\"hljs-comment\">//System.out.println(&quot;路径:&quot;+file.getPath());</span><br>                <span class=\"hljs-comment\">//System.out.println(&quot;拥有者:&quot;+file.getOwner());</span><br>                <span class=\"hljs-comment\">//System.out.println(&quot;权限:&quot;+file.getPermission().toString());</span><br>                <span class=\"hljs-comment\">//System.out.println();</span><br>                <span class=\"hljs-keyword\">if</span> (file.isFile())&#123;<br>                    System.out.println(file.getPath().getName()+<span class=\"hljs-string\">&quot;是文件&quot;</span>);<br>                &#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (file.isDirectory())&#123;<br>                    System.out.println(file.getPath().getName()+<span class=\"hljs-string\">&quot;是目录&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;error&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><code>FileStatus</code> 中包含了文件的基本信息，比如文件路径，是否是文件夹，修改时间，访问时间，所有者，所属组，文件权限，是否是符号链接等，输出内容示例如下：</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs properties\"><span class=\"hljs-attr\">FileStatus&#123;</span><br><span class=\"hljs-attr\">path</span>=<span class=\"hljs-string\">hdfs://192.168.239.161:9000/xiaokang/test; </span><br><span class=\"hljs-attr\">isDirectory</span>=<span class=\"hljs-string\">true; </span><br><span class=\"hljs-attr\">modification_time</span>=<span class=\"hljs-string\">1556680796191; </span><br><span class=\"hljs-attr\">access_time</span>=<span class=\"hljs-string\">0; </span><br><span class=\"hljs-attr\">owner</span>=<span class=\"hljs-string\">xiaokang; </span><br><span class=\"hljs-attr\">group</span>=<span class=\"hljs-string\">supergroup; </span><br><span class=\"hljs-attr\">permission</span>=<span class=\"hljs-string\">rwxr-xr-x; </span><br><span class=\"hljs-attr\">isSymlink</span>=<span class=\"hljs-string\">false</span><br><span class=\"hljs-attr\">&#125;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-递归查看目录下所有文件的详细信息\"><a href=\"#2-3-递归查看目录下所有文件的详细信息\" class=\"headerlink\" title=\"2.3 递归查看目录下所有文件的详细信息\"></a>2.3 递归查看目录下所有文件的详细信息</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//递归查看目录下所有文件的详细信息</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testFileDetails</span><span class=\"hljs-params\">(String path)</span></span>&#123;<br>        FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            fs=HDFSUtils.getFileSystem();<br>            <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>                RemoteIterator&lt;LocatedFileStatus&gt; fileList = fs.listFiles(<span class=\"hljs-keyword\">new</span> Path(path),<span class=\"hljs-keyword\">true</span>);<br>                <span class=\"hljs-keyword\">while</span> (fileList.hasNext())&#123;<br>                    LocatedFileStatus file = fileList.next();<br>                    <span class=\"hljs-comment\">//每个文件的详细信息</span><br>                    System.out.println(file.getOwner()+<span class=\"hljs-string\">&quot;--&quot;</span>+file.getPermission());<br>                    <span class=\"hljs-comment\">//文件的块信息</span><br>                    BlockLocation[] blocks = file.getBlockLocations();<br>                    <span class=\"hljs-keyword\">int</span> i=<span class=\"hljs-number\">0</span>;<br>                    <span class=\"hljs-keyword\">for</span>(BlockLocation block:blocks)&#123;<br>                        String[] hosts = block.getHosts();<br>                        System.out.println(<span class=\"hljs-string\">&quot;块数：&quot;</span>+block.getLength());<br>                        System.out.println(<span class=\"hljs-string\">&quot;第【&quot;</span>+i+<span class=\"hljs-string\">&quot;】块：&quot;</span>+ Arrays.toString(hosts));<br>                        i++;<br>                    &#125;<br>                    System.out.println(<span class=\"hljs-string\">&quot;===================&quot;</span>);<br>                &#125;<br>            &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>                System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>            &#125;<br>        &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;创建失败&quot;</span>+e.getMessage());<br>        &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>            HDFSUtils.closeFileSystem(fs);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-创建目录\"><a href=\"#2-4-创建目录\" class=\"headerlink\" title=\"2.4 创建目录\"></a>2.4 创建目录</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//创建目录,支持递归创建</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testMkdirs</span><span class=\"hljs-params\">(String path)</span> <span class=\"hljs-keyword\">throws</span> Exception</span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            fs.mkdirs(<span class=\"hljs-keyword\">new</span> Path(path));<br>            System.out.println(<span class=\"hljs-string\">&quot;创建成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;创建失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-文件复制\"><a href=\"#2-5-文件复制\" class=\"headerlink\" title=\"2.5 文件复制\"></a>2.5 文件复制</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//集群内文件复制</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testCopy</span><span class=\"hljs-params\">(String src,String dest)</span></span>&#123;<br>    FileSystem fileSystem=<span class=\"hljs-keyword\">null</span>;<br>    FSDataInputStream in=<span class=\"hljs-keyword\">null</span>;<br>    FSDataOutputStream out=<span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span>&#123;<br>        fileSystem = HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fileSystem!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            in=fileSystem.open(<span class=\"hljs-keyword\">new</span> Path(src));<br>            out=fileSystem.create(<span class=\"hljs-keyword\">new</span> Path(dest));<br>            IOUtils.copyBytes(in,out,<span class=\"hljs-number\">4096</span>);<br>            System.out.println(<span class=\"hljs-string\">&quot;复制完成&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;error&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            out.close();<br>            in.close();<br>            HDFSUtils.closeFileSystem(fileSystem);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-6-文件重命名\"><a href=\"#2-6-文件重命名\" class=\"headerlink\" title=\"2.6 文件重命名\"></a>2.6 文件重命名</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//集群文件重命名</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testRename</span><span class=\"hljs-params\">(String oldName,String newName)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            fs.rename(<span class=\"hljs-keyword\">new</span> Path(oldName),<span class=\"hljs-keyword\">new</span> Path(newName));<br>            System.out.println(<span class=\"hljs-string\">&quot;重命名成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;重命名失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-7-删除目录或文件\"><a href=\"#2-7-删除目录或文件\" class=\"headerlink\" title=\"2.7 删除目录或文件\"></a>2.7 删除目录或文件</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">\t<span class=\"hljs-comment\">/*</span><br><span class=\"hljs-comment\">     *  delete方法中第二个参数代表是否递归删除</span><br><span class=\"hljs-comment\">     *    +  如果 path 是一个目录且递归删除为 true, 则删除该目录及其中所有文件;</span><br><span class=\"hljs-comment\">     *    +  如果 path 是一个目录但递归删除为 false,则会则抛出异常。</span><br><span class=\"hljs-comment\">     */</span><br><span class=\"hljs-comment\">//删除集群中目录或文件</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testDelete</span><span class=\"hljs-params\">(String path)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            fs.delete(<span class=\"hljs-keyword\">new</span> Path(path),<span class=\"hljs-keyword\">true</span>);<br>            System.out.println(<span class=\"hljs-string\">&quot;删除成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;删除失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-8-上传文件到HDFS\"><a href=\"#2-8-上传文件到HDFS\" class=\"headerlink\" title=\"2.8 上传文件到HDFS\"></a>2.8 上传文件到HDFS</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//本地文件上传至HDFS</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testPut</span><span class=\"hljs-params\">(String localSrc,String hdfsDest)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            fs.copyFromLocalFile(<span class=\"hljs-keyword\">new</span> Path(localSrc),<span class=\"hljs-keyword\">new</span> Path(hdfsDest));<br>            System.out.println(<span class=\"hljs-string\">&quot;上传成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;上传失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-9-上传文件到HDFS-IO流方式\"><a href=\"#2-9-上传文件到HDFS-IO流方式\" class=\"headerlink\" title=\"2.9 上传文件到HDFS-IO流方式\"></a>2.9 上传文件到HDFS-IO流方式</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//本地文件上传至HDFS-IO流方式</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testPutWithIO</span><span class=\"hljs-params\">(String localSrc,String hdfsDest)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    FileInputStream in=<span class=\"hljs-keyword\">null</span>;<br>    FSDataOutputStream out=<span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            in=<span class=\"hljs-keyword\">new</span> FileInputStream(<span class=\"hljs-keyword\">new</span> File(localSrc));<br>            out=fs.create(<span class=\"hljs-keyword\">new</span> Path(hdfsDest));<br>            IOUtils.copyBytes(in,out,<span class=\"hljs-number\">4096</span>);<br>            System.out.println(<span class=\"hljs-string\">&quot;IO流-上传成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;IO流-上传失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            out.close();<br>            in.close();<br>            HDFSUtils.closeFileSystem(fs);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-10-从HDFS上下载文件\"><a href=\"#2-10-从HDFS上下载文件\" class=\"headerlink\" title=\"2.10 从HDFS上下载文件\"></a>2.10 从HDFS上下载文件</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//从HDFS下载文件到本地</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testGet</span><span class=\"hljs-params\">(String hdfsSrc,String localDest)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            fs.copyToLocalFile(<span class=\"hljs-keyword\">new</span> Path(hdfsSrc),<span class=\"hljs-keyword\">new</span> Path(localDest));<br>            System.out.println(<span class=\"hljs-string\">&quot;下载成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;下载失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br><br>\t<span class=\"hljs-comment\">/*</span><br><span class=\"hljs-comment\">     * 第一个参数控制下载完成后是否删除源文件,默认是 true,即删除;</span><br><span class=\"hljs-comment\">     * 最后一个参数表示是否将 RawLocalFileSystem 用作本地文件系统;</span><br><span class=\"hljs-comment\">     * RawLocalFileSystem 默认为 false,通常情况下可以不设置,</span><br><span class=\"hljs-comment\">     * 但如果你在执行时候抛出 NullPointerException 异常,则代表你的文件系统与程序可能存在不兼容的情况 (window 下常见),</span><br><span class=\"hljs-comment\">     * 此时可以将 RawLocalFileSystem 设置为 true</span><br><span class=\"hljs-comment\">     */</span><br>    fs.copyToLocalFile(<span class=\"hljs-keyword\">false</span>, src, dst, <span class=\"hljs-keyword\">true</span>);<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-11-从HDFS上下载文件-IO流方式\"><a href=\"#2-11-从HDFS上下载文件-IO流方式\" class=\"headerlink\" title=\"2.11 从HDFS上下载文件-IO流方式\"></a>2.11 从HDFS上下载文件-IO流方式</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//从HDFS下载文件到本地-IO流方式</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testGetWithIO</span><span class=\"hljs-params\">(String hdfsSrc,String localDest)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    FSDataInputStream in=<span class=\"hljs-keyword\">null</span>;<br>    FileOutputStream out=<span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            in=fs.open(<span class=\"hljs-keyword\">new</span> Path(hdfsSrc));<br>            out=<span class=\"hljs-keyword\">new</span> FileOutputStream(<span class=\"hljs-keyword\">new</span> File(localDest));<br>            IOUtils.copyBytes(in,out,<span class=\"hljs-number\">4096</span>);<br>            System.out.println(<span class=\"hljs-string\">&quot;IO流-下载成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;IO流-下载失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<br/>\n\n<p><strong>以上所有测试用例下载地址</strong>：<a href=\"https://github.com/heibaiying/BigData-Notes/tree/master/code/Hadoop/hdfs-java-api\">HDFS-JavaAPI</a></p>\n","more":"<h2 id=\"一、前置准备\"><a href=\"#一、前置准备\" class=\"headerlink\" title=\"一、前置准备\"></a>一、前置准备</h2><h3 id=\"1-Windows下配置开发环境\"><a href=\"#1-Windows下配置开发环境\" class=\"headerlink\" title=\"1. Windows下配置开发环境\"></a>1. Windows下配置开发环境</h3><div align=\"center\"> <img width=\"600px\" src=\"https://raw.githubusercontent.com/xiaokangxxs/notebook/master/docs/BigData/Hadoop/hadoop_home.png\"/> </div>\n<div align=\"center\"> <img width=\"600px\" src=\"https://raw.githubusercontent.com/xiaokangxxs/notebook/master/docs/BigData/Hadoop/hadoopenv.png\"/> </div>\n### 2. 基于IDEA创建 maven jar工程\n\n<p>想要使用 HDFS API，需要导入依赖<code>hadoop-common</code>、<code>hadoop-client</code>、 <code>hadoop-hdfs</code>、<code>hadoop-client</code></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class=\"hljs-tag\">         <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"hljs-tag\">         <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">modelVersion</span>&gt;</span>4.0.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">modelVersion</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>cool.xiaokang<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hdfs-java-api<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">properties</span>&gt;</span><br>        <span class=\"hljs-comment\">&lt;!-- jdk版本 --&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">jdk.version</span>&gt;</span>8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">jdk.version</span>&gt;</span><br>        <span class=\"hljs-comment\">&lt;!-- 设置字符编码 --&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project.build.sourceEncoding</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project.reporting.outputEncoding</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">hadoop.version</span>&gt;</span>2.7.7<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">hadoop.version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">properties</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencies</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>log4j-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.11.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-client<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-hdfs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>junit<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>junit<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.12<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>test<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencies</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">build</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugins</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.8.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span><br>                    <span class=\"hljs-comment\">&lt;!-- 设置编译字符编码 --&gt;</span><br>                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">encoding</span>&gt;</span>UTF-8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">encoding</span>&gt;</span><br>                    <span class=\"hljs-comment\">&lt;!-- 设置编译jdk版本 --&gt;</span><br>                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">source</span>&gt;</span>$&#123;jdk.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">source</span>&gt;</span><br>                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">target</span>&gt;</span>$&#123;jdk.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">target</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugins</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">build</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p><strong>log4j.properties</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs properties\"><span class=\"hljs-meta\">log4j.rootLogger</span>=<span class=\"hljs-string\">INFO,console,file</span><br><span class=\"hljs-comment\">#配置输出到控制台</span><br><span class=\"hljs-meta\">log4j.appender.console</span>=<span class=\"hljs-string\">org.apache.log4j.ConsoleAppender</span><br><span class=\"hljs-meta\">log4j.appender.console.layout</span>=<span class=\"hljs-string\">org.apache.log4j.PatternLayout</span><br><span class=\"hljs-meta\">log4j.appender.console.Encoding</span>=<span class=\"hljs-string\">UTF-8</span><br><span class=\"hljs-meta\">log4j.appender.console.layout.ConversionPattern</span>=<span class=\"hljs-string\">%d&#123;yyyy-MM-dd HH\\:mm\\:ss&#125; -%-4r [%t] %-5p  %x - %m%n</span><br><span class=\"hljs-comment\">#配置输入日志到日志文件</span><br><span class=\"hljs-meta\">log4j.appender.file</span>=<span class=\"hljs-string\">org.apache.log4j.FileAppender</span><br><span class=\"hljs-meta\">log4j.appender.file.File</span>=<span class=\"hljs-string\">target/mylog.log</span><br><span class=\"hljs-meta\">log4j.appender.file.layout</span>=<span class=\"hljs-string\">org.apache.log4j.PatternLayout</span><br><span class=\"hljs-meta\">log4j.appender.file.layout.ConversionPattern</span>=<span class=\"hljs-string\">%d %p [%c] - %m%n</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"二、API的使用\"><a href=\"#二、API的使用\" class=\"headerlink\" title=\"二、API的使用\"></a>二、API的使用</h2><h3 id=\"2-1-FileSystem\"><a href=\"#2-1-FileSystem\" class=\"headerlink\" title=\"2.1 FileSystem\"></a>2.1 FileSystem</h3><p>FileSystem 是所有 HDFS 操作的主入口。由于之后的每个小功能的测试都需要用到它，这里使用写了一个工具类HDFSUtils</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> cool.xiaokang.utils;<br><br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.conf.Configuration;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.fs.FileSystem;<br><br><span class=\"hljs-keyword\">import</span> java.io.IOException;<br><span class=\"hljs-keyword\">import</span> java.net.URI;<br><br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * HDFS工具类</span><br><span class=\"hljs-comment\"> *</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> xiaokang</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HDFSUtils</span> </span>&#123;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String HDFS_PATH = <span class=\"hljs-string\">&quot;hdfs://192.168.239.161:9000&quot;</span>;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String HDFS_USER = <span class=\"hljs-string\">&quot;xiaokang&quot;</span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 获取FileSystem对象</span><br><span class=\"hljs-comment\">     *</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span></span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> FileSystem <span class=\"hljs-title\">getFileSystem</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Configuration conf = <span class=\"hljs-keyword\">new</span> Configuration();<br>            <span class=\"hljs-comment\">//conf.set(&quot;dfs.replication&quot;, &quot;3&quot;);</span><br>       \t\t<span class=\"hljs-comment\">//conf.addResource(&quot;hdfs-site.xml&quot;);</span><br>            FileSystem fileSystem = FileSystem.get(<span class=\"hljs-keyword\">new</span> URI(HDFS_PATH), conf, HDFS_USER);<br>            <span class=\"hljs-keyword\">return</span> fileSystem;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (Exception e) &#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！！---&quot;</span> + e.getMessage());<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br>    &#125;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 关闭FileSystem对象</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> fileSystem</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">closeFileSystem</span><span class=\"hljs-params\">(FileSystem fileSystem)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (fileSystem != <span class=\"hljs-keyword\">null</span>) &#123;<br>            <span class=\"hljs-keyword\">try</span> &#123;<br>                fileSystem.close();<br>            &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-实现-ls列表查看\"><a href=\"#2-2-实现-ls列表查看\" class=\"headerlink\" title=\"2.2 实现-ls列表查看\"></a>2.2 实现<code>-ls</code>列表查看</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//HDFS Shell操作：hdfs dfs -ls /input</span><br><span class=\"hljs-comment\">//查看指定目录下所有文件的信息</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testFileStatus</span><span class=\"hljs-params\">(String path)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            FileStatus[] fileStatuses = fs.listStatus(<span class=\"hljs-keyword\">new</span> Path(path));<br>            <span class=\"hljs-keyword\">for</span>(FileStatus file:fileStatuses)&#123;<br>                <span class=\"hljs-comment\">//fileStatus的toString方法被重写过，直接打印可以看到所有信息</span><br>                <span class=\"hljs-comment\">//System.out.println(file.toString());</span><br>                <span class=\"hljs-comment\">//System.out.println(&quot;路径:&quot;+file.getPath());</span><br>                <span class=\"hljs-comment\">//System.out.println(&quot;拥有者:&quot;+file.getOwner());</span><br>                <span class=\"hljs-comment\">//System.out.println(&quot;权限:&quot;+file.getPermission().toString());</span><br>                <span class=\"hljs-comment\">//System.out.println();</span><br>                <span class=\"hljs-keyword\">if</span> (file.isFile())&#123;<br>                    System.out.println(file.getPath().getName()+<span class=\"hljs-string\">&quot;是文件&quot;</span>);<br>                &#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (file.isDirectory())&#123;<br>                    System.out.println(file.getPath().getName()+<span class=\"hljs-string\">&quot;是目录&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;error&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><code>FileStatus</code> 中包含了文件的基本信息，比如文件路径，是否是文件夹，修改时间，访问时间，所有者，所属组，文件权限，是否是符号链接等，输出内容示例如下：</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs properties\"><span class=\"hljs-attr\">FileStatus&#123;</span><br><span class=\"hljs-attr\">path</span>=<span class=\"hljs-string\">hdfs://192.168.239.161:9000/xiaokang/test; </span><br><span class=\"hljs-attr\">isDirectory</span>=<span class=\"hljs-string\">true; </span><br><span class=\"hljs-attr\">modification_time</span>=<span class=\"hljs-string\">1556680796191; </span><br><span class=\"hljs-attr\">access_time</span>=<span class=\"hljs-string\">0; </span><br><span class=\"hljs-attr\">owner</span>=<span class=\"hljs-string\">xiaokang; </span><br><span class=\"hljs-attr\">group</span>=<span class=\"hljs-string\">supergroup; </span><br><span class=\"hljs-attr\">permission</span>=<span class=\"hljs-string\">rwxr-xr-x; </span><br><span class=\"hljs-attr\">isSymlink</span>=<span class=\"hljs-string\">false</span><br><span class=\"hljs-attr\">&#125;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-递归查看目录下所有文件的详细信息\"><a href=\"#2-3-递归查看目录下所有文件的详细信息\" class=\"headerlink\" title=\"2.3 递归查看目录下所有文件的详细信息\"></a>2.3 递归查看目录下所有文件的详细信息</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//递归查看目录下所有文件的详细信息</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testFileDetails</span><span class=\"hljs-params\">(String path)</span></span>&#123;<br>        FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            fs=HDFSUtils.getFileSystem();<br>            <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>                RemoteIterator&lt;LocatedFileStatus&gt; fileList = fs.listFiles(<span class=\"hljs-keyword\">new</span> Path(path),<span class=\"hljs-keyword\">true</span>);<br>                <span class=\"hljs-keyword\">while</span> (fileList.hasNext())&#123;<br>                    LocatedFileStatus file = fileList.next();<br>                    <span class=\"hljs-comment\">//每个文件的详细信息</span><br>                    System.out.println(file.getOwner()+<span class=\"hljs-string\">&quot;--&quot;</span>+file.getPermission());<br>                    <span class=\"hljs-comment\">//文件的块信息</span><br>                    BlockLocation[] blocks = file.getBlockLocations();<br>                    <span class=\"hljs-keyword\">int</span> i=<span class=\"hljs-number\">0</span>;<br>                    <span class=\"hljs-keyword\">for</span>(BlockLocation block:blocks)&#123;<br>                        String[] hosts = block.getHosts();<br>                        System.out.println(<span class=\"hljs-string\">&quot;块数：&quot;</span>+block.getLength());<br>                        System.out.println(<span class=\"hljs-string\">&quot;第【&quot;</span>+i+<span class=\"hljs-string\">&quot;】块：&quot;</span>+ Arrays.toString(hosts));<br>                        i++;<br>                    &#125;<br>                    System.out.println(<span class=\"hljs-string\">&quot;===================&quot;</span>);<br>                &#125;<br>            &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>                System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>            &#125;<br>        &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;创建失败&quot;</span>+e.getMessage());<br>        &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>            HDFSUtils.closeFileSystem(fs);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-创建目录\"><a href=\"#2-4-创建目录\" class=\"headerlink\" title=\"2.4 创建目录\"></a>2.4 创建目录</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//创建目录,支持递归创建</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testMkdirs</span><span class=\"hljs-params\">(String path)</span> <span class=\"hljs-keyword\">throws</span> Exception</span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            fs.mkdirs(<span class=\"hljs-keyword\">new</span> Path(path));<br>            System.out.println(<span class=\"hljs-string\">&quot;创建成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;创建失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-文件复制\"><a href=\"#2-5-文件复制\" class=\"headerlink\" title=\"2.5 文件复制\"></a>2.5 文件复制</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//集群内文件复制</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testCopy</span><span class=\"hljs-params\">(String src,String dest)</span></span>&#123;<br>    FileSystem fileSystem=<span class=\"hljs-keyword\">null</span>;<br>    FSDataInputStream in=<span class=\"hljs-keyword\">null</span>;<br>    FSDataOutputStream out=<span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span>&#123;<br>        fileSystem = HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fileSystem!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            in=fileSystem.open(<span class=\"hljs-keyword\">new</span> Path(src));<br>            out=fileSystem.create(<span class=\"hljs-keyword\">new</span> Path(dest));<br>            IOUtils.copyBytes(in,out,<span class=\"hljs-number\">4096</span>);<br>            System.out.println(<span class=\"hljs-string\">&quot;复制完成&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;error&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            out.close();<br>            in.close();<br>            HDFSUtils.closeFileSystem(fileSystem);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-6-文件重命名\"><a href=\"#2-6-文件重命名\" class=\"headerlink\" title=\"2.6 文件重命名\"></a>2.6 文件重命名</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//集群文件重命名</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testRename</span><span class=\"hljs-params\">(String oldName,String newName)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            fs.rename(<span class=\"hljs-keyword\">new</span> Path(oldName),<span class=\"hljs-keyword\">new</span> Path(newName));<br>            System.out.println(<span class=\"hljs-string\">&quot;重命名成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;重命名失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-7-删除目录或文件\"><a href=\"#2-7-删除目录或文件\" class=\"headerlink\" title=\"2.7 删除目录或文件\"></a>2.7 删除目录或文件</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">\t<span class=\"hljs-comment\">/*</span><br><span class=\"hljs-comment\">     *  delete方法中第二个参数代表是否递归删除</span><br><span class=\"hljs-comment\">     *    +  如果 path 是一个目录且递归删除为 true, 则删除该目录及其中所有文件;</span><br><span class=\"hljs-comment\">     *    +  如果 path 是一个目录但递归删除为 false,则会则抛出异常。</span><br><span class=\"hljs-comment\">     */</span><br><span class=\"hljs-comment\">//删除集群中目录或文件</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testDelete</span><span class=\"hljs-params\">(String path)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            fs.delete(<span class=\"hljs-keyword\">new</span> Path(path),<span class=\"hljs-keyword\">true</span>);<br>            System.out.println(<span class=\"hljs-string\">&quot;删除成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;删除失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-8-上传文件到HDFS\"><a href=\"#2-8-上传文件到HDFS\" class=\"headerlink\" title=\"2.8 上传文件到HDFS\"></a>2.8 上传文件到HDFS</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//本地文件上传至HDFS</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testPut</span><span class=\"hljs-params\">(String localSrc,String hdfsDest)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            fs.copyFromLocalFile(<span class=\"hljs-keyword\">new</span> Path(localSrc),<span class=\"hljs-keyword\">new</span> Path(hdfsDest));<br>            System.out.println(<span class=\"hljs-string\">&quot;上传成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;上传失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-9-上传文件到HDFS-IO流方式\"><a href=\"#2-9-上传文件到HDFS-IO流方式\" class=\"headerlink\" title=\"2.9 上传文件到HDFS-IO流方式\"></a>2.9 上传文件到HDFS-IO流方式</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//本地文件上传至HDFS-IO流方式</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testPutWithIO</span><span class=\"hljs-params\">(String localSrc,String hdfsDest)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    FileInputStream in=<span class=\"hljs-keyword\">null</span>;<br>    FSDataOutputStream out=<span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            in=<span class=\"hljs-keyword\">new</span> FileInputStream(<span class=\"hljs-keyword\">new</span> File(localSrc));<br>            out=fs.create(<span class=\"hljs-keyword\">new</span> Path(hdfsDest));<br>            IOUtils.copyBytes(in,out,<span class=\"hljs-number\">4096</span>);<br>            System.out.println(<span class=\"hljs-string\">&quot;IO流-上传成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;IO流-上传失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            out.close();<br>            in.close();<br>            HDFSUtils.closeFileSystem(fs);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-10-从HDFS上下载文件\"><a href=\"#2-10-从HDFS上下载文件\" class=\"headerlink\" title=\"2.10 从HDFS上下载文件\"></a>2.10 从HDFS上下载文件</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//从HDFS下载文件到本地</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testGet</span><span class=\"hljs-params\">(String hdfsSrc,String localDest)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            fs.copyToLocalFile(<span class=\"hljs-keyword\">new</span> Path(hdfsSrc),<span class=\"hljs-keyword\">new</span> Path(localDest));<br>            System.out.println(<span class=\"hljs-string\">&quot;下载成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;下载失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br><br>\t<span class=\"hljs-comment\">/*</span><br><span class=\"hljs-comment\">     * 第一个参数控制下载完成后是否删除源文件,默认是 true,即删除;</span><br><span class=\"hljs-comment\">     * 最后一个参数表示是否将 RawLocalFileSystem 用作本地文件系统;</span><br><span class=\"hljs-comment\">     * RawLocalFileSystem 默认为 false,通常情况下可以不设置,</span><br><span class=\"hljs-comment\">     * 但如果你在执行时候抛出 NullPointerException 异常,则代表你的文件系统与程序可能存在不兼容的情况 (window 下常见),</span><br><span class=\"hljs-comment\">     * 此时可以将 RawLocalFileSystem 设置为 true</span><br><span class=\"hljs-comment\">     */</span><br>    fs.copyToLocalFile(<span class=\"hljs-keyword\">false</span>, src, dst, <span class=\"hljs-keyword\">true</span>);<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-11-从HDFS上下载文件-IO流方式\"><a href=\"#2-11-从HDFS上下载文件-IO流方式\" class=\"headerlink\" title=\"2.11 从HDFS上下载文件-IO流方式\"></a>2.11 从HDFS上下载文件-IO流方式</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//从HDFS下载文件到本地-IO流方式</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testGetWithIO</span><span class=\"hljs-params\">(String hdfsSrc,String localDest)</span></span>&#123;<br>    FileSystem fs = <span class=\"hljs-keyword\">null</span>;<br>    FSDataInputStream in=<span class=\"hljs-keyword\">null</span>;<br>    FileOutputStream out=<span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>        fs=HDFSUtils.getFileSystem();<br>        <span class=\"hljs-keyword\">if</span> (fs!=<span class=\"hljs-keyword\">null</span>)&#123;<br>            in=fs.open(<span class=\"hljs-keyword\">new</span> Path(hdfsSrc));<br>            out=<span class=\"hljs-keyword\">new</span> FileOutputStream(<span class=\"hljs-keyword\">new</span> File(localDest));<br>            IOUtils.copyBytes(in,out,<span class=\"hljs-number\">4096</span>);<br>            System.out.println(<span class=\"hljs-string\">&quot;IO流-下载成功！！！&quot;</span>);<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            System.out.println(<span class=\"hljs-string\">&quot;获取FileSystem失败！！&quot;</span>);<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>        System.out.println(<span class=\"hljs-string\">&quot;IO流-下载失败&quot;</span>+e.getMessage());<br>    &#125;<span class=\"hljs-keyword\">finally</span> &#123;<br>        HDFSUtils.closeFileSystem(fs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<br/>\n\n<p><strong>以上所有测试用例下载地址</strong>：<a href=\"https://github.com/heibaiying/BigData-Notes/tree/master/code/Hadoop/hdfs-java-api\">HDFS-JavaAPI</a></p>\n","categories":[{"name":"Hadoop","path":"api/categories/Hadoop.json"}],"tags":[{"name":"Hadoop","path":"api/tags/Hadoop.json"},{"name":"java","path":"api/tags/java.json"},{"name":"API","path":"api/tags/API.json"}]}